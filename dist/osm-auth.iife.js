var osmAuth=(function(){var je=Object.create;var I=Object.defineProperty;var Ee=Object.getOwnPropertyDescriptor;var Fe=Object.getOwnPropertyNames;var qe=Object.getPrototypeOf,Ce=Object.prototype.hasOwnProperty;var h=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},Te=function(e,t){for(var r in t)I(e,r,{get:t[r],enumerable:!0})},W=function(e,t,r,a){if(t&&typeof t=="object"||typeof t=="function")for(var i=Fe(t),p=0,u=i.length,o;p<u;p++)o=i[p],!Ce.call(e,o)&&o!==r&&I(e,o,{get:function(n){return t[n]}.bind(null,o),enumerable:!(a=Ee(t,o))||a.enumerable});return e};var Ie=function(e,t,r){return r=e!=null?je(qe(e)):{},W(t||!e||!e.__esModule?I(r,"default",{value:e,enumerable:!0}):r,e)},Je=function(e){return W(I({},"__esModule",{value:!0}),e)};var y=h(function(Dt,H){var N=Re(),Ne=Ge(),ke=Ue(),Me=typeof window!="undefined"?window:global;H.exports={assign:N,create:Ne,trim:ke,bind:Le,slice:k,each:X,map:ze,pluck:M,isList:R,isFunction:De,isObject:$e,Global:Me};function Re(){return Object.assign?Object.assign:function(t,r,a,i){for(var p=1;p<arguments.length;p++)X(Object(arguments[p]),function(u,o){t[o]=u});return t}}function Ge(){if(Object.create)return function(r,a,i,p){var u=k(arguments,1);return N.apply(this,[Object.create(r)].concat(u))};var t=function(){},e=t;return function(a,i,p,u){var o=k(arguments,1);return t.prototype=a,N.apply(this,[new t].concat(o))}}function Ue(){return String.prototype.trim?function(t){return String.prototype.trim.call(t)}:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function Le(e,t){return function(){return t.apply(e,Array.prototype.slice.call(arguments,0))}}function k(e,t){return Array.prototype.slice.call(e,t||0)}function X(e,t){M(e,function(r,a){return t(r,a),!1})}function ze(e,t){var r=R(e)?[]:{};return M(e,function(a,i){return r[i]=t(a,i),!1}),r}function M(e,t){if(R(e)){for(var r=0;r<e.length;r++)if(t(e[r],r))return e[r]}else for(var a in e)if(e.hasOwnProperty(a)&&t(e[a],a))return e[a]}function R(e){return e!=null&&typeof e!="function"&&typeof e.length=="number"}function De(e){return e&&{}.toString.call(e)==="[object Function]"}function $e(e){return e&&{}.toString.call(e)==="[object Object]"}});var Q=h(function($t,K){var _=y(),Be=_.slice,We=_.pluck,S=_.each,Xe=_.bind,He=_.create,G=_.isList,U=_.isFunction,Ke=_.isObject;K.exports={createStore:L};var Qe={version:"2.0.12",enabled:!1,get:function(e,t){var r=this.storage.read(this._namespacePrefix+e);return this._deserialize(r,t)},set:function(e,t){return t===void 0?this.remove(e):(this.storage.write(this._namespacePrefix+e,this._serialize(t)),t)},remove:function(e){this.storage.remove(this._namespacePrefix+e)},each:function(e){var t=this;this.storage.each(function(r,a){e.call(t,t._deserialize(r),(a||"").replace(t._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(e){return this._namespacePrefix=="__storejs_"+e+"_"},createStore:function(){return L.apply(this,arguments)},addPlugin:function(e){this._addPlugin(e)},namespace:function(e){return L(this.storage,this.plugins,e)}};function Ze(){var e=typeof console=="undefined"?null:console;if(e){var t=e.warn?e.warn:e.log;t.apply(e,arguments)}}function L(e,t,r){r||(r=""),e&&!G(e)&&(e=[e]),t&&!G(t)&&(t=[t]);var a=r?"__storejs_"+r+"_":"",i=r?new RegExp("^"+a):null,p=/^[a-zA-Z0-9_\-]*$/;if(!p.test(r))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var u={_namespacePrefix:a,_namespaceRegexp:i,_testStorage:function(n){try{var l="__storejs__test__";n.write(l,l);var c=n.read(l)===l;return n.remove(l),c}catch(d){return!1}},_assignPluginFnProp:function(n,l){var c=this[l];this[l]=function(){var s=Be(arguments,0),g=this;function v(){if(c)return S(arguments,function(J,m){s[m]=J}),c.apply(g,s)}var w=[v].concat(s);return n.apply(g,w)}},_serialize:function(n){return JSON.stringify(n)},_deserialize:function(n,l){if(!n)return l;var c="";try{c=JSON.parse(n)}catch(d){c=n}return c!==void 0?c:l},_addStorage:function(n){this.enabled||this._testStorage(n)&&(this.storage=n,this.enabled=!0)},_addPlugin:function(n){var l=this;if(G(n)){S(n,function(s){l._addPlugin(s)});return}var c=We(this.plugins,function(s){return n===s});if(!c){if(this.plugins.push(n),!U(n))throw new Error("Plugins must be function values that return objects");var d=n.call(this);if(!Ke(d))throw new Error("Plugins must return an object of function properties");S(d,function(s,g){if(!U(s))throw new Error("Bad plugin property: "+g+" from plugin "+n.name+". Plugins should only return functions.");l._assignPluginFnProp(s,g)})}},addStorage:function(n){Ze("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(n)}},o=He(u,Qe,{plugins:[]});return o.raw={},S(o,function(n,l){U(n)&&(o.raw[l]=Xe(o,n))}),S(e,function(n){o._addStorage(n)}),S(t,function(n){o._addPlugin(n)}),o}});var V=h(function(Bt,Y){var Ye=y(),Ve=Ye.Global;Y.exports={name:"localStorage",read:Z,write:et,each:tt,remove:rt,clearAll:nt};function A(){return Ve.localStorage}function Z(e){return A().getItem(e)}function et(e,t){return A().setItem(e,t)}function tt(e){for(var t=A().length-1;t>=0;t--){var r=A().key(t);e(Z(r),r)}}function rt(e){return A().removeItem(e)}function nt(){return A().clear()}});var re=h(function(Wt,te){var at=y(),it=at.Global;te.exports={name:"oldFF-globalStorage",read:ot,write:ut,each:ee,remove:ct,clearAll:st};var b=it.globalStorage;function ot(e){return b[e]}function ut(e,t){b[e]=t}function ee(e){for(var t=b.length-1;t>=0;t--){var r=b.key(t);e(b[r],r)}}function ct(e){return b.removeItem(e)}function st(){ee(function(e,t){delete b[e]})}});var ie=h(function(Xt,ae){var ft=y(),z=ft.Global;ae.exports={name:"oldIE-userDataStorage",write:lt,read:pt,each:dt,remove:gt,clearAll:ht};var E="storejs",P=z.document,F=mt(),ne=(z.navigator?z.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);function lt(e,t){if(!ne){var r=D(e);F(function(a){a.setAttribute(r,t),a.save(E)})}}function pt(e){if(!ne){var t=D(e),r=null;return F(function(a){r=a.getAttribute(t)}),r}}function dt(e){F(function(t){for(var r=t.XMLDocument.documentElement.attributes,a=r.length-1;a>=0;a--){var i=r[a];e(t.getAttribute(i.name),i.name)}})}function gt(e){var t=D(e);F(function(r){r.removeAttribute(t),r.save(E)})}function ht(){F(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(E);for(var r=t.length-1;r>=0;r--)e.removeAttribute(t[r].name);e.save(E)})}var vt=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function D(e){return e.replace(/^\d/,"___$&").replace(vt,"___")}function mt(){if(!P||!P.documentElement||!P.documentElement.addBehavior)return null;var e="script",t,r,a;try{r=new ActiveXObject("htmlfile"),r.open(),r.write("<"+e+">document.w=window</"+e+'><iframe src="/favicon.ico"></iframe>'),r.close(),t=r.w.frames[0].document,a=t.createElement("div")}catch(i){a=P.createElement("div"),t=P.body}return function(i){var p=[].slice.call(arguments,0);p.unshift(a),t.appendChild(a),a.addBehavior("#default#userData"),a.load(E),i.apply(this,p),t.removeChild(a)}}});var le=h(function(Ht,fe){var oe=y(),_t=oe.Global,wt=oe.trim;fe.exports={name:"cookieStorage",read:yt,write:bt,each:ue,remove:ce,clearAll:xt};var q=_t.document;function yt(e){if(!e||!se(e))return null;var t="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(q.cookie.replace(new RegExp(t),"$1"))}function ue(e){for(var t=q.cookie.split(/; ?/g),r=t.length-1;r>=0;r--)if(wt(t[r])){var a=t[r].split("="),i=unescape(a[0]),p=unescape(a[1]);e(p,i)}}function bt(e,t){e&&(q.cookie=escape(e)+"="+escape(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function ce(e){!e||!se(e)||(q.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function xt(){ue(function(e,t){ce(t)})}function se(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(q.cookie)}});var ge=h(function(Kt,de){var St=y(),At=St.Global;de.exports={name:"sessionStorage",read:pe,write:Ot,each:Pt,remove:jt,clearAll:Et};function O(){return At.sessionStorage}function pe(e){return O().getItem(e)}function Ot(e,t){return O().setItem(e,t)}function Pt(e){for(var t=O().length-1;t>=0;t--){var r=O().key(t);e(pe(r),r)}}function jt(e){return O().removeItem(e)}function Et(){return O().clear()}});var ve=h(function(Qt,he){he.exports={name:"memoryStorage",read:Ft,write:qt,each:Ct,remove:Tt,clearAll:It};var x={};function Ft(e){return x[e]}function qt(e,t){x[e]=t}function Ct(e){for(var t in x)x.hasOwnProperty(t)&&e(x[t],t)}function Tt(e){delete x[e]}function It(e){x={}}});var _e=h(function(Zt,me){me.exports=[V(),re(),ie(),le(),ge(),ve()]});var we=h(function(exports,module){typeof JSON!="object"&&(JSON={});(function(){"use strict";var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(e){return e<10?"0"+e:e}function this_value(){return this.valueOf()}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;function quote(e){return rx_escapable.lastIndex=0,rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(t){var r=meta[t];return typeof r=="string"?r:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var r,a,i,p,u=gap,o,n=t[e];switch(n&&typeof n=="object"&&typeof n.toJSON=="function"&&(n=n.toJSON(e)),typeof rep=="function"&&(n=rep.call(t,e,n)),typeof n){case"string":return quote(n);case"number":return isFinite(n)?String(n):"null";case"boolean":case"null":return String(n);case"object":if(!n)return"null";if(gap+=indent,o=[],Object.prototype.toString.apply(n)==="[object Array]"){for(p=n.length,r=0;r<p;r+=1)o[r]=str(r,n)||"null";return i=o.length===0?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+u+"]":"["+o.join(",")+"]",gap=u,i}if(rep&&typeof rep=="object")for(p=rep.length,r=0;r<p;r+=1)typeof rep[r]=="string"&&(a=rep[r],i=str(a,n),i&&o.push(quote(a)+(gap?": ":":")+i));else for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i=str(a,n),i&&o.push(quote(a)+(gap?": ":":")+i));return i=o.length===0?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+u+"}":"{"+o.join(",")+"}",gap=u,i}}typeof JSON.stringify!="function"&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,r){var a;if(gap="",indent="",typeof r=="number")for(a=0;a<r;a+=1)indent+=" ";else typeof r=="string"&&(indent=r);if(rep=t,t&&typeof t!="function"&&(typeof t!="object"||typeof t.length!="number"))throw new Error("JSON.stringify");return str("",{"":e})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){var j;function walk(e,t){var r,a,i=e[t];if(i&&typeof i=="object")for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(a=walk(i,r),a!==void 0?i[r]=a:delete i[r]);return reviver.call(e,t,i)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})})()});var be=h(function(Yt,ye){ye.exports=Jt;function Jt(){return we(),{}}});var Se=h(function(Vt,xe){var Nt=Q(),kt=_e(),Mt=[be()];xe.exports=Nt.createStore(kt,Mt)});var Lt={};Te(Lt,{osmAuth:function(){return Rt}});var C=Ie(Se(),1);function Rt(e){var t={};t.authenticated=function(){return!!i("oauth2_access_token")},t.logout=function(){return i("oauth2_access_token",""),i("oauth_token",""),i("oauth_token_secret",""),i("oauth_request_token_secret",""),t},t.authenticate=function(u){if(t.authenticated()){u(null,t);return}t.logout(),Gt(function(o){r(o,u)})};function r(u,o){var n=Ut(),l=e.url+"/oauth2/authorize?"+Ae({client_id:e.client_id,redirect_uri:e.redirect_uri,response_type:"code",scope:e.scope,state:n,code_challenge:u.code_challenge,code_challenge_method:u.code_challenge_method});if(e.singlepage){if(!C.default.enabled){var c=new Error("local storage unavailable, but require in singlepage mode");c.status="pkce-localstorage-unavailable",o(c);return}var d=$(window.location.search.slice(1));d.code?t.bootstrapToken(d.code,o):(i("oauth2_state",n),i("oauth2_pkce_code_verifier",u.code_verifier),window.location=l)}else{var s=600,g=550,v=[["width",s],["height",g],["left",window.screen.width/2-s/2],["top",window.screen.height/2-g/2]].map(function(m){return m.join("=")}).join(","),w=window.open("about:blank","oauth_window",v);t.popupWindow=w,w.location=l,w||(c=new Error("Popup was blocked"),c.status="popup-blocked",o(c))}window.authComplete=function(m){var T=$(m.split("?")[1]);if(T.state!==n){c=new Error("Invalid state"),c.status="invalid-state",o(c);return}a(T.code,u.code_verifier,J),delete window.authComplete};function J(m,T){if(e.done(),m){o(m);return}var Pe=JSON.parse(T.response);i("oauth2_access_token",Pe.access_token),o(null,t)}}function a(u,o,n){var l=e.url+"/oauth2/token?"+Ae({client_id:e.client_id,redirect_uri:e.redirect_uri,grant_type:"authorization_code",code:u,code_verifier:o});t.rawxhr("POST",l,null,null,null,n),e.loading()}t.bringPopupWindowToFront=function(){var u=!1;try{t.popupWindow&&!t.popupWindow.closed&&(t.popupWindow.focus(),u=!0)}catch(o){}return u},t.bootstrapToken=function(u,o){var n=i("oauth2_state");i("oauth2_state","");var l=$(window.location.search.slice(1));if(l.state!==n){var c=new Error("Invalid state");c.status="invalid-state",o(c);return}var d=i("oauth2_pkce_code_verifier");i("oauth2_pkce_code_verifier",""),a(u,d,s);function s(g,v){if(e.done(),g){o(g);return}var w=JSON.parse(v.response);i("oauth2_access_token",w.access_token),o(null,t)}},t.fetch=function(u,o,n){if(t.authenticated())return l();if(e.auto){t.authenticate(l);return}else{n("not authenticated",null);return}function l(){var c=o.prefix!==!1?e.url+u:u,d=o.headers||{"Content-Type":"application/x-www-form-urlencoded"};return d.Authorization="Bearer "+i("oauth2_access_token"),fetch(c,{method:o.method,body:o.body,headers:d}).then(function(s){var g=s.headers.get("content-type").split(";")[0];switch(g){case"text/html":case"text/xml":return s.text().then(function(v){return new window.DOMParser().parseFromString(v,g)});case"application/html":return s.json();default:return s.text()}})}},t.xhr=function(u,o){if(t.authenticated())return n();if(e.auto){t.authenticate(n);return}else{o("not authenticated",null);return}function n(){var c=u.prefix!==!1?e.url+u.path:u.path;return t.rawxhr(u.method,c,i("oauth2_access_token"),u.content,u.headers,l)}function l(c,d){c?o(c):d.responseXML?o(c,d.responseXML):o(c,d.response)}},t.rawxhr=function(u,o,n,l,c,d){c=c||{"Content-Type":"application/x-www-form-urlencoded"},n&&(c.Authorization="Bearer "+n);var s=new XMLHttpRequest;s.onreadystatechange=function(){s.readyState===4&&s.status!==0&&(/^20\d$/.test(s.status)?d(null,s):d(s,null))},s.onerror=function(v){d(v,null)},s.open(u,o,!0);for(var g in c)s.setRequestHeader(g,c[g]);return s.send(l),s},t.preauth=function(u){return u&&u.access_token&&i("oauth2_access_token",u.access_token),t},t.options=function(u){return arguments.length?(e=u,e.url=e.url||"https://www.openstreetmap.org",e.auto=e.auto||!1,e.singlepage=e.singlepage||!1,e.loading=e.loading||function(){},e.done=e.done||function(){},t.preauth(e)):e};var i;if(C.default.enabled)i=function(u,o){if(arguments.length===1)return C.default.get(e.url+u);if(arguments.length===2)return C.default.set(e.url+u,o)};else{var p={};i=function(u,o){if(arguments.length===1)return p[e.url+u];if(arguments.length===2)return p[e.url+u]=o}}return t.options(e),t}function Ae(e){return Object.keys(e).filter(function(t){return e[t]!==void 0}).sort().map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function $(e){for(var t=0;t<e.length&&(e[t]==="?"||e[t]==="#");)t++;return e=e.slice(t),e.split("&").reduce(function(r,a){var i=a.split("=");return i.length===2&&(r[i[0]]=decodeURIComponent(i[1])),r},{})}function Oe(){return window&&window.crypto&&window.crypto.getRandomValues&&window.crypto.subtle&&window.crypto.subtle.digest}function Gt(e){var t;if(Oe()){var r=window.crypto.getRandomValues(new Uint8Array(32));t=B(r.buffer);var a=Uint8Array.from(Array.from(t).map(function(u){return u.charCodeAt(0)}));window.crypto.subtle.digest("SHA-256",a).then(function(u){var o=B(u);e({code_challenge:o,code_verifier:t,code_challenge_method:"S256"})})}else{var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";t="";for(var p=0;p<64;p++)t+=i[Math.floor(Math.random()*i.length)];e({code_verifier:t,code_challenge:t,code_challenge_method:"plain"})}}function Ut(){var e;if(Oe()){var t=window.crypto.getRandomValues(new Uint8Array(32));e=B(t.buffer)}else{var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";e="";for(var a=0;a<64;a++)e+=r[Math.floor(Math.random()*r.length)]}return e}function B(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/[=]/g,"")}return Je(Lt);})();
//# sourceMappingURL=osm-auth.iife.js.map
