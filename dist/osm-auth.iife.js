var osmAuth=(function(){var Ee=Object.create;var I=Object.defineProperty;var Fe=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var Ce=Object.getPrototypeOf,Te=Object.prototype.hasOwnProperty;var h=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},Ie=function(e,t){for(var r in t)I(e,r,{get:t[r],enumerable:!0})},B=function(e,t,r,i){if(t&&typeof t=="object"||typeof t=="function")for(var o=qe(t),l=0,u=o.length,a;l<u;l++)a=o[l],!Te.call(e,a)&&a!==r&&I(e,a,{get:function(n){return t[n]}.bind(null,a),enumerable:!(i=Fe(t,a))||i.enumerable});return e};var Je=function(e,t,r){return r=e!=null?Ee(Ce(e)):{},B(t||!e||!e.__esModule?I(r,"default",{value:e,enumerable:!0}):r,e)},Ne=function(e){return B(I({},"__esModule",{value:!0}),e)};var y=h(function(Dt,H){var N=Ge(),ke=Ue(),Re=Le(),Me=typeof window!="undefined"?window:global;H.exports={assign:N,create:ke,trim:Re,bind:ze,slice:k,each:W,map:De,pluck:R,isList:M,isFunction:Xe,isObject:$e,Global:Me};function Ge(){return Object.assign?Object.assign:function(t,r,i,o){for(var l=1;l<arguments.length;l++)W(Object(arguments[l]),function(u,a){t[a]=u});return t}}function Ue(){if(Object.create)return function(r,i,o,l){var u=k(arguments,1);return N.apply(this,[Object.create(r)].concat(u))};var t=function(){},e=t;return function(i,o,l,u){var a=k(arguments,1);return t.prototype=i,N.apply(this,[new t].concat(a))}}function Le(){return String.prototype.trim?function(t){return String.prototype.trim.call(t)}:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function ze(e,t){return function(){return t.apply(e,Array.prototype.slice.call(arguments,0))}}function k(e,t){return Array.prototype.slice.call(e,t||0)}function W(e,t){R(e,function(r,i){return t(r,i),!1})}function De(e,t){var r=M(e)?[]:{};return R(e,function(i,o){return r[o]=t(i,o),!1}),r}function R(e,t){if(M(e)){for(var r=0;r<e.length;r++)if(t(e[r],r))return e[r]}else for(var i in e)if(e.hasOwnProperty(i)&&t(e[i],i))return e[i]}function M(e){return e!=null&&typeof e!="function"&&typeof e.length=="number"}function Xe(e){return e&&{}.toString.call(e)==="[object Function]"}function $e(e){return e&&{}.toString.call(e)==="[object Object]"}});var Q=h(function(Xt,K){var _=y(),Be=_.slice,We=_.pluck,x=_.each,He=_.bind,Ke=_.create,G=_.isList,U=_.isFunction,Qe=_.isObject;K.exports={createStore:L};var Ze={version:"2.0.12",enabled:!1,get:function(e,t){var r=this.storage.read(this._namespacePrefix+e);return this._deserialize(r,t)},set:function(e,t){return t===void 0?this.remove(e):(this.storage.write(this._namespacePrefix+e,this._serialize(t)),t)},remove:function(e){this.storage.remove(this._namespacePrefix+e)},each:function(e){var t=this;this.storage.each(function(r,i){e.call(t,t._deserialize(r),(i||"").replace(t._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(e){return this._namespacePrefix=="__storejs_"+e+"_"},createStore:function(){return L.apply(this,arguments)},addPlugin:function(e){this._addPlugin(e)},namespace:function(e){return L(this.storage,this.plugins,e)}};function Ye(){var e=typeof console=="undefined"?null:console;if(e){var t=e.warn?e.warn:e.log;t.apply(e,arguments)}}function L(e,t,r){r||(r=""),e&&!G(e)&&(e=[e]),t&&!G(t)&&(t=[t]);var i=r?"__storejs_"+r+"_":"",o=r?new RegExp("^"+i):null,l=/^[a-zA-Z0-9_\-]*$/;if(!l.test(r))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var u={_namespacePrefix:i,_namespaceRegexp:o,_testStorage:function(n){try{var s="__storejs__test__";n.write(s,s);var c=n.read(s)===s;return n.remove(s),c}catch(d){return!1}},_assignPluginFnProp:function(n,s){var c=this[s];this[s]=function(){var p=Be(arguments,0),g=this;function m(){if(c)return x(arguments,function(J,v){p[v]=J}),c.apply(g,p)}var w=[m].concat(p);return n.apply(g,w)}},_serialize:function(n){return JSON.stringify(n)},_deserialize:function(n,s){if(!n)return s;var c="";try{c=JSON.parse(n)}catch(d){c=n}return c!==void 0?c:s},_addStorage:function(n){this.enabled||this._testStorage(n)&&(this.storage=n,this.enabled=!0)},_addPlugin:function(n){var s=this;if(G(n)){x(n,function(p){s._addPlugin(p)});return}var c=We(this.plugins,function(p){return n===p});if(!c){if(this.plugins.push(n),!U(n))throw new Error("Plugins must be function values that return objects");var d=n.call(this);if(!Qe(d))throw new Error("Plugins must return an object of function properties");x(d,function(p,g){if(!U(p))throw new Error("Bad plugin property: "+g+" from plugin "+n.name+". Plugins should only return functions.");s._assignPluginFnProp(p,g)})}},addStorage:function(n){Ye("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(n)}},a=Ke(u,Ze,{plugins:[]});return a.raw={},x(a,function(n,s){U(n)&&(a.raw[s]=He(a,n))}),x(e,function(n){a._addStorage(n)}),x(t,function(n){a._addPlugin(n)}),a}});var V=h(function($t,Y){var Ve=y(),et=Ve.Global;Y.exports={name:"localStorage",read:Z,write:tt,each:rt,remove:nt,clearAll:at};function A(){return et.localStorage}function Z(e){return A().getItem(e)}function tt(e,t){return A().setItem(e,t)}function rt(e){for(var t=A().length-1;t>=0;t--){var r=A().key(t);e(Z(r),r)}}function nt(e){return A().removeItem(e)}function at(){return A().clear()}});var re=h(function(Bt,te){var it=y(),ot=it.Global;te.exports={name:"oldFF-globalStorage",read:ut,write:ct,each:ee,remove:st,clearAll:ft};var b=ot.globalStorage;function ut(e){return b[e]}function ct(e,t){b[e]=t}function ee(e){for(var t=b.length-1;t>=0;t--){var r=b.key(t);e(b[r],r)}}function st(e){return b.removeItem(e)}function ft(){ee(function(e,t){delete b[e]})}});var ie=h(function(Wt,ae){var lt=y(),z=lt.Global;ae.exports={name:"oldIE-userDataStorage",write:pt,read:dt,each:gt,remove:ht,clearAll:vt};var E="storejs",P=z.document,F=mt(),ne=(z.navigator?z.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);function pt(e,t){if(!ne){var r=D(e);F(function(i){i.setAttribute(r,t),i.save(E)})}}function dt(e){if(!ne){var t=D(e),r=null;return F(function(i){r=i.getAttribute(t)}),r}}function gt(e){F(function(t){for(var r=t.XMLDocument.documentElement.attributes,i=r.length-1;i>=0;i--){var o=r[i];e(t.getAttribute(o.name),o.name)}})}function ht(e){var t=D(e);F(function(r){r.removeAttribute(t),r.save(E)})}function vt(){F(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(E);for(var r=t.length-1;r>=0;r--)e.removeAttribute(t[r].name);e.save(E)})}var _t=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function D(e){return e.replace(/^\d/,"___$&").replace(_t,"___")}function mt(){if(!P||!P.documentElement||!P.documentElement.addBehavior)return null;var e="script",t,r,i;try{r=new ActiveXObject("htmlfile"),r.open(),r.write("<"+e+">document.w=window</"+e+'><iframe src="/favicon.ico"></iframe>'),r.close(),t=r.w.frames[0].document,i=t.createElement("div")}catch(o){i=P.createElement("div"),t=P.body}return function(o){var l=[].slice.call(arguments,0);l.unshift(i),t.appendChild(i),i.addBehavior("#default#userData"),i.load(E),o.apply(this,l),t.removeChild(i)}}});var le=h(function(Ht,fe){var oe=y(),wt=oe.Global,yt=oe.trim;fe.exports={name:"cookieStorage",read:bt,write:St,each:ue,remove:ce,clearAll:xt};var q=wt.document;function bt(e){if(!e||!se(e))return null;var t="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(q.cookie.replace(new RegExp(t),"$1"))}function ue(e){for(var t=q.cookie.split(/; ?/g),r=t.length-1;r>=0;r--)if(yt(t[r])){var i=t[r].split("="),o=unescape(i[0]),l=unescape(i[1]);e(l,o)}}function St(e,t){e&&(q.cookie=escape(e)+"="+escape(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function ce(e){!e||!se(e)||(q.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function xt(){ue(function(e,t){ce(t)})}function se(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(q.cookie)}});var ge=h(function(Kt,de){var At=y(),Ot=At.Global;de.exports={name:"sessionStorage",read:pe,write:Pt,each:jt,remove:Et,clearAll:Ft};function O(){return Ot.sessionStorage}function pe(e){return O().getItem(e)}function Pt(e,t){return O().setItem(e,t)}function jt(e){for(var t=O().length-1;t>=0;t--){var r=O().key(t);e(pe(r),r)}}function Et(e){return O().removeItem(e)}function Ft(){return O().clear()}});var ve=h(function(Qt,he){he.exports={name:"memoryStorage",read:qt,write:Ct,each:Tt,remove:It,clearAll:Jt};var S={};function qt(e){return S[e]}function Ct(e,t){S[e]=t}function Tt(e){for(var t in S)S.hasOwnProperty(t)&&e(S[t],t)}function It(e){delete S[e]}function Jt(e){S={}}});var me=h(function(Zt,_e){_e.exports=[V(),re(),ie(),le(),ge(),ve()]});var we=h(function(exports,module){typeof JSON!="object"&&(JSON={});(function(){"use strict";var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(e){return e<10?"0"+e:e}function this_value(){return this.valueOf()}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;function quote(e){return rx_escapable.lastIndex=0,rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(t){var r=meta[t];return typeof r=="string"?r:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var r,i,o,l,u=gap,a,n=t[e];switch(n&&typeof n=="object"&&typeof n.toJSON=="function"&&(n=n.toJSON(e)),typeof rep=="function"&&(n=rep.call(t,e,n)),typeof n){case"string":return quote(n);case"number":return isFinite(n)?String(n):"null";case"boolean":case"null":return String(n);case"object":if(!n)return"null";if(gap+=indent,a=[],Object.prototype.toString.apply(n)==="[object Array]"){for(l=n.length,r=0;r<l;r+=1)a[r]=str(r,n)||"null";return o=a.length===0?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+u+"]":"["+a.join(",")+"]",gap=u,o}if(rep&&typeof rep=="object")for(l=rep.length,r=0;r<l;r+=1)typeof rep[r]=="string"&&(i=rep[r],o=str(i,n),o&&a.push(quote(i)+(gap?": ":":")+o));else for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(o=str(i,n),o&&a.push(quote(i)+(gap?": ":":")+o));return o=a.length===0?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+u+"}":"{"+a.join(",")+"}",gap=u,o}}typeof JSON.stringify!="function"&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,r){var i;if(gap="",indent="",typeof r=="number")for(i=0;i<r;i+=1)indent+=" ";else typeof r=="string"&&(indent=r);if(rep=t,t&&typeof t!="function"&&(typeof t!="object"||typeof t.length!="number"))throw new Error("JSON.stringify");return str("",{"":e})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){var j;function walk(e,t){var r,i,o=e[t];if(o&&typeof o=="object")for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i=walk(o,r),i!==void 0?o[r]=i:delete o[r]);return reviver.call(e,t,o)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})})()});var be=h(function(Yt,ye){ye.exports=Nt;function Nt(){return we(),{}}});var xe=h(function(Vt,Se){var kt=Q(),Rt=me(),Mt=[be()];Se.exports=kt.createStore(Rt,Mt)});var Lt={};Ie(Lt,{osmAuth:function(){return Gt}});var C=Je(xe(),1);function Gt(e){var t={};t.authenticated=function(){return!!o("oauth2_access_token")},t.logout=function(){return o("oauth2_access_token",""),o("oauth_token",""),o("oauth_token_secret",""),o("oauth_request_token_secret",""),t},t.authenticate=function(u){if(t.authenticated()){u(null,t);return}t.logout(),Oe(function(a){r(a,u)})},t.authenticateAsync=function(){return t.authenticated()?Promise.resolve(t):(t.logout(),new Promise(function(u,a){var n=function(s,c){s?a(new Error(s)):u(c)};Oe(function(s){return r(s,n)})}))};function r(u,a){var n=Ut(),s=e.url+"/oauth2/authorize?"+Ae({client_id:e.client_id,redirect_uri:e.redirect_uri,response_type:"code",scope:e.scope,state:n,code_challenge:u.code_challenge,code_challenge_method:u.code_challenge_method});if(e.singlepage){if(!C.default.enabled){var c=new Error("local storage unavailable, but require in singlepage mode");c.status="pkce-localstorage-unavailable",a(c);return}var d=X(window.location.search.slice(1));d.code?t.bootstrapToken(d.code,a):(o("oauth2_state",n),o("oauth2_pkce_code_verifier",u.code_verifier),window.location=s)}else{var p=600,g=550,m=[["width",p],["height",g],["left",window.screen.width/2-p/2],["top",window.screen.height/2-g/2]].map(function(v){return v.join("=")}).join(","),w=window.open("about:blank","oauth_window",m);t.popupWindow=w,w.location=s,w||(c=new Error("Popup was blocked"),c.status="popup-blocked",a(c))}window.authComplete=function(v){var T=X(v.split("?")[1]);if(T.state!==n){c=new Error("Invalid state"),c.status="invalid-state",a(c);return}i(T.code,u.code_verifier,J),delete window.authComplete};function J(v,T){if(e.done(),v){a(v);return}var je=JSON.parse(T.response);o("oauth2_access_token",je.access_token),a(null,t)}}function i(u,a,n){var s=e.url+"/oauth2/token?"+Ae({client_id:e.client_id,redirect_uri:e.redirect_uri,grant_type:"authorization_code",code:u,code_verifier:a});t.rawxhr("POST",s,null,null,null,n),e.loading()}t.bringPopupWindowToFront=function(){var u=!1;try{t.popupWindow&&!t.popupWindow.closed&&(t.popupWindow.focus(),u=!0)}catch(a){}return u},t.bootstrapToken=function(u,a){var n=o("oauth2_state");o("oauth2_state","");var s=X(window.location.search.slice(1));if(s.state!==n){var c=new Error("Invalid state");c.status="invalid-state",a(c);return}var d=o("oauth2_pkce_code_verifier");o("oauth2_pkce_code_verifier",""),i(u,d,p);function p(g,m){if(e.done(),g){a(g);return}var w=JSON.parse(m.response);o("oauth2_access_token",w.access_token),a(null,t)}},t.fetch=function(u,a){if(t.authenticated())return n();return e.auto?t.authenticateAsync().then(n):Promise.reject(new Error("not authenticated"));function n(){return a=a||{},a.headers||(a.headers={"Content-Type":"application/x-www-form-urlencoded"}),a.headers.Authorization="Bearer "+o("oauth2_access_token"),fetch(u,a)}},t.xhr=function(u,a){if(t.authenticated())return n();if(e.auto){t.authenticate(n);return}else{a("not authenticated",null);return}function n(){var c=u.prefix!==!1?e.url+u.path:u.path;return t.rawxhr(u.method,c,o("oauth2_access_token"),u.content,u.headers,s)}function s(c,d){c?a(c):d.responseXML?a(c,d.responseXML):a(c,d.response)}},t.rawxhr=function(u,a,n,s,c,d){c=c||{"Content-Type":"application/x-www-form-urlencoded"},n&&(c.Authorization="Bearer "+n);var p=new XMLHttpRequest;p.onreadystatechange=function(){p.readyState===4&&p.status!==0&&(/^20\d$/.test(p.status)?d(null,p):d(p,null))},p.onerror=function(m){d(m,null)},p.open(u,a,!0);for(var g in c)p.setRequestHeader(g,c[g]);return p.send(s),p},t.preauth=function(u){return u&&u.access_token&&o("oauth2_access_token",u.access_token),t},t.options=function(u){return arguments.length?(e=u,e.url=e.url||"https://www.openstreetmap.org",e.auto=e.auto||!1,e.singlepage=e.singlepage||!1,e.loading=e.loading||function(){},e.done=e.done||function(){},t.preauth(e)):e};var o;if(C.default.enabled)o=function(u,a){if(arguments.length===1)return C.default.get(e.url+u);if(arguments.length===2)return C.default.set(e.url+u,a)};else{var l={};o=function(u,a){if(arguments.length===1)return l[e.url+u];if(arguments.length===2)return l[e.url+u]=a}}return t.options(e),t}function Ae(e){return Object.keys(e).filter(function(t){return e[t]!==void 0}).sort().map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function X(e){for(var t=0;t<e.length&&(e[t]==="?"||e[t]==="#");)t++;return e=e.slice(t),e.split("&").reduce(function(r,i){var o=i.split("=");return o.length===2&&(r[o[0]]=decodeURIComponent(o[1])),r},{})}function Pe(){return window&&window.crypto&&window.crypto.getRandomValues&&window.crypto.subtle&&window.crypto.subtle.digest}function Oe(e){var t;if(Pe()){var r=window.crypto.getRandomValues(new Uint8Array(32));t=$(r.buffer);var i=Uint8Array.from(Array.from(t).map(function(u){return u.charCodeAt(0)}));window.crypto.subtle.digest("SHA-256",i).then(function(u){var a=$(u);e({code_challenge:a,code_verifier:t,code_challenge_method:"S256"})})}else{var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";t="";for(var l=0;l<64;l++)t+=o[Math.floor(Math.random()*o.length)];e({code_verifier:t,code_challenge:t,code_challenge_method:"plain"})}}function Ut(){var e;if(Pe()){var t=window.crypto.getRandomValues(new Uint8Array(32));e=$(t.buffer)}else{var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";e="";for(var i=0;i<64;i++)e+=r[Math.floor(Math.random()*r.length)]}return e}function $(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/[=]/g,"")}return Ne(Lt);})();
//# sourceMappingURL=osm-auth.iife.js.map
