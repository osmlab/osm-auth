var osmAuth=(function(){var Ce=Object.create;var k=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var Ee=Object.getOwnPropertyNames;var Te=Object.getPrototypeOf,Je=Object.prototype.hasOwnProperty;var h=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},Ne=function(e,t){for(var r in t)k(e,r,{get:t[r],enumerable:!0})},X=function(e,t,r,i){if(t&&typeof t=="object"||typeof t=="function")for(var o=Ee(t),u=0,g=o.length,a;u<g;u++)a=o[u],!Je.call(e,a)&&a!==r&&k(e,a,{get:function(n){return t[n]}.bind(null,a),enumerable:!(i=qe(t,a))||i.enumerable});return e};var ke=function(e,t,r){return r=e!=null?Ce(Te(e)):{},X(t||!e||!e.__esModule?k(r,"default",{value:e,enumerable:!0}):r,e)},Ie=function(e){return X(k({},"__esModule",{value:!0}),e)};var y=h(function(Bt,K){var I=Ue(),Me=Le(),Re=ze(),Ge=typeof window!="undefined"?window:global;K.exports={assign:I,create:Me,trim:Re,bind:De,slice:M,each:H,map:$e,pluck:R,isList:G,isFunction:Be,isObject:We,Global:Ge};function Ue(){return Object.assign?Object.assign:function(t,r,i,o){for(var u=1;u<arguments.length;u++)H(Object(arguments[u]),function(g,a){t[a]=g});return t}}function Le(){if(Object.create)return function(r,i,o,u){var g=M(arguments,1);return I.apply(this,[Object.create(r)].concat(g))};var t=function(){},e=t;return function(i,o,u,g){var a=M(arguments,1);return t.prototype=i,I.apply(this,[new t].concat(a))}}function ze(){return String.prototype.trim?function(t){return String.prototype.trim.call(t)}:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function De(e,t){return function(){return t.apply(e,Array.prototype.slice.call(arguments,0))}}function M(e,t){return Array.prototype.slice.call(e,t||0)}function H(e,t){R(e,function(r,i){return t(r,i),!1})}function $e(e,t){var r=G(e)?[]:{};return R(e,function(i,o){return r[o]=t(i,o),!1}),r}function R(e,t){if(G(e)){for(var r=0;r<e.length;r++)if(t(e[r],r))return e[r]}else for(var i in e)if(e.hasOwnProperty(i)&&t(e[i],i))return e[i]}function G(e){return e!=null&&typeof e!="function"&&typeof e.length=="number"}function Be(e){return e&&{}.toString.call(e)==="[object Function]"}function We(e){return e&&{}.toString.call(e)==="[object Object]"}});var Z=h(function(Wt,Q){var _=y(),Xe=_.slice,He=_.pluck,A=_.each,Ke=_.bind,Qe=_.create,U=_.isList,L=_.isFunction,Ze=_.isObject;Q.exports={createStore:z};var Ye={version:"2.0.12",enabled:!1,get:function(e,t){var r=this.storage.read(this._namespacePrefix+e);return this._deserialize(r,t)},set:function(e,t){return t===void 0?this.remove(e):(this.storage.write(this._namespacePrefix+e,this._serialize(t)),t)},remove:function(e){this.storage.remove(this._namespacePrefix+e)},each:function(e){var t=this;this.storage.each(function(r,i){e.call(t,t._deserialize(r),(i||"").replace(t._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(e){return this._namespacePrefix=="__storejs_"+e+"_"},createStore:function(){return z.apply(this,arguments)},addPlugin:function(e){this._addPlugin(e)},namespace:function(e){return z(this.storage,this.plugins,e)}};function Ve(){var e=typeof console=="undefined"?null:console;if(e){var t=e.warn?e.warn:e.log;t.apply(e,arguments)}}function z(e,t,r){r||(r=""),e&&!U(e)&&(e=[e]),t&&!U(t)&&(t=[t]);var i=r?"__storejs_"+r+"_":"",o=r?new RegExp("^"+i):null,u=/^[a-zA-Z0-9_\-]*$/;if(!u.test(r))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var g={_namespacePrefix:i,_namespaceRegexp:o,_testStorage:function(n){try{var c="__storejs__test__";n.write(c,c);var s=n.read(c)===c;return n.remove(c),s}catch(l){return!1}},_assignPluginFnProp:function(n,c){var s=this[c];this[c]=function(){var p=Xe(arguments,0),d=this;function v(){if(s)return A(arguments,function(C,w){p[w]=C}),s.apply(d,p)}var m=[v].concat(p);return n.apply(d,m)}},_serialize:function(n){return JSON.stringify(n)},_deserialize:function(n,c){if(!n)return c;var s="";try{s=JSON.parse(n)}catch(l){s=n}return s!==void 0?s:c},_addStorage:function(n){this.enabled||this._testStorage(n)&&(this.storage=n,this.enabled=!0)},_addPlugin:function(n){var c=this;if(U(n)){A(n,function(p){c._addPlugin(p)});return}var s=He(this.plugins,function(p){return n===p});if(!s){if(this.plugins.push(n),!L(n))throw new Error("Plugins must be function values that return objects");var l=n.call(this);if(!Ze(l))throw new Error("Plugins must return an object of function properties");A(l,function(p,d){if(!L(p))throw new Error("Bad plugin property: "+d+" from plugin "+n.name+". Plugins should only return functions.");c._assignPluginFnProp(p,d)})}},addStorage:function(n){Ve("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(n)}},a=Qe(g,Ye,{plugins:[]});return a.raw={},A(a,function(n,c){L(n)&&(a.raw[c]=Ke(a,n))}),A(e,function(n){a._addStorage(n)}),A(t,function(n){a._addPlugin(n)}),a}});var ee=h(function(Xt,V){var et=y(),tt=et.Global;V.exports={name:"localStorage",read:Y,write:rt,each:nt,remove:at,clearAll:it};function O(){return tt.localStorage}function Y(e){return O().getItem(e)}function rt(e,t){return O().setItem(e,t)}function nt(e){for(var t=O().length-1;t>=0;t--){var r=O().key(t);e(Y(r),r)}}function at(e){return O().removeItem(e)}function it(){return O().clear()}});var ne=h(function(Ht,re){var ot=y(),ut=ot.Global;re.exports={name:"oldFF-globalStorage",read:ct,write:st,each:te,remove:ft,clearAll:lt};var b=ut.globalStorage;function ct(e){return b[e]}function st(e,t){b[e]=t}function te(e){for(var t=b.length-1;t>=0;t--){var r=b.key(t);e(b[r],r)}}function ft(e){return b.removeItem(e)}function lt(){te(function(e,t){delete b[e]})}});var oe=h(function(Kt,ie){var pt=y(),D=pt.Global;ie.exports={name:"oldIE-userDataStorage",write:dt,read:gt,each:ht,remove:vt,clearAll:_t};var E="storejs",q=D.document,T=wt(),ae=(D.navigator?D.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);function dt(e,t){if(!ae){var r=$(e);T(function(i){i.setAttribute(r,t),i.save(E)})}}function gt(e){if(!ae){var t=$(e),r=null;return T(function(i){r=i.getAttribute(t)}),r}}function ht(e){T(function(t){for(var r=t.XMLDocument.documentElement.attributes,i=r.length-1;i>=0;i--){var o=r[i];e(t.getAttribute(o.name),o.name)}})}function vt(e){var t=$(e);T(function(r){r.removeAttribute(t),r.save(E)})}function _t(){T(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(E);for(var r=t.length-1;r>=0;r--)e.removeAttribute(t[r].name);e.save(E)})}var mt=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function $(e){return e.replace(/^\d/,"___$&").replace(mt,"___")}function wt(){if(!q||!q.documentElement||!q.documentElement.addBehavior)return null;var e="script",t,r,i;try{r=new ActiveXObject("htmlfile"),r.open(),r.write("<"+e+">document.w=window</"+e+'><iframe src="/favicon.ico"></iframe>'),r.close(),t=r.w.frames[0].document,i=t.createElement("div")}catch(o){i=q.createElement("div"),t=q.body}return function(o){var u=[].slice.call(arguments,0);u.unshift(i),t.appendChild(i),i.addBehavior("#default#userData"),i.load(E),o.apply(this,u),t.removeChild(i)}}});var pe=h(function(Qt,le){var ue=y(),yt=ue.Global,bt=ue.trim;le.exports={name:"cookieStorage",read:xt,write:St,each:ce,remove:se,clearAll:At};var J=yt.document;function xt(e){if(!e||!fe(e))return null;var t="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(J.cookie.replace(new RegExp(t),"$1"))}function ce(e){for(var t=J.cookie.split(/; ?/g),r=t.length-1;r>=0;r--)if(bt(t[r])){var i=t[r].split("="),o=unescape(i[0]),u=unescape(i[1]);e(u,o)}}function St(e,t){e&&(J.cookie=escape(e)+"="+escape(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function se(e){!e||!fe(e)||(J.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function At(){ce(function(e,t){se(t)})}function fe(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(J.cookie)}});var he=h(function(Zt,ge){var Ot=y(),Pt=Ot.Global;ge.exports={name:"sessionStorage",read:de,write:jt,each:Ft,remove:Ct,clearAll:qt};function P(){return Pt.sessionStorage}function de(e){return P().getItem(e)}function jt(e,t){return P().setItem(e,t)}function Ft(e){for(var t=P().length-1;t>=0;t--){var r=P().key(t);e(de(r),r)}}function Ct(e){return P().removeItem(e)}function qt(){return P().clear()}});var _e=h(function(Yt,ve){ve.exports={name:"memoryStorage",read:Et,write:Tt,each:Jt,remove:Nt,clearAll:kt};var x={};function Et(e){return x[e]}function Tt(e,t){x[e]=t}function Jt(e){for(var t in x)x.hasOwnProperty(t)&&e(x[t],t)}function Nt(e){delete x[e]}function kt(e){x={}}});var we=h(function(Vt,me){me.exports=[ee(),ne(),oe(),pe(),he(),_e()]});var ye=h(function(exports,module){typeof JSON!="object"&&(JSON={});(function(){"use strict";var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(e){return e<10?"0"+e:e}function this_value(){return this.valueOf()}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;function quote(e){return rx_escapable.lastIndex=0,rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(t){var r=meta[t];return typeof r=="string"?r:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var r,i,o,u,g=gap,a,n=t[e];switch(n&&typeof n=="object"&&typeof n.toJSON=="function"&&(n=n.toJSON(e)),typeof rep=="function"&&(n=rep.call(t,e,n)),typeof n){case"string":return quote(n);case"number":return isFinite(n)?String(n):"null";case"boolean":case"null":return String(n);case"object":if(!n)return"null";if(gap+=indent,a=[],Object.prototype.toString.apply(n)==="[object Array]"){for(u=n.length,r=0;r<u;r+=1)a[r]=str(r,n)||"null";return o=a.length===0?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+g+"]":"["+a.join(",")+"]",gap=g,o}if(rep&&typeof rep=="object")for(u=rep.length,r=0;r<u;r+=1)typeof rep[r]=="string"&&(i=rep[r],o=str(i,n),o&&a.push(quote(i)+(gap?": ":":")+o));else for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(o=str(i,n),o&&a.push(quote(i)+(gap?": ":":")+o));return o=a.length===0?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+g+"}":"{"+a.join(",")+"}",gap=g,o}}typeof JSON.stringify!="function"&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,r){var i;if(gap="",indent="",typeof r=="number")for(i=0;i<r;i+=1)indent+=" ";else typeof r=="string"&&(indent=r);if(rep=t,t&&typeof t!="function"&&(typeof t!="object"||typeof t.length!="number"))throw new Error("JSON.stringify");return str("",{"":e})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){var j;function walk(e,t){var r,i,o=e[t];if(o&&typeof o=="object")for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i=walk(o,r),i!==void 0?o[r]=i:delete o[r]);return reviver.call(e,t,o)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})})()});var xe=h(function(er,be){be.exports=It;function It(){return ye(),{}}});var Ae=h(function(tr,Se){var Mt=Z(),Rt=we(),Gt=[xe()];Se.exports=Mt.createStore(Rt,Gt)});var Dt={};Ne(Dt,{osmAuth:function(){return Ut}});var F=ke(Ae(),1);function Ut(e){var t={},r=!e.singlepage||F.default.enabled;t.authenticated=function(){return!!u("oauth2_access_token")},t.logout=function(){return u("oauth2_access_token",""),u("oauth_token",""),u("oauth_token_secret",""),u("oauth_request_token_secret",""),t},t.authenticate=function(a){if(t.authenticated()){a(null,t);return}t.logout(),r?Lt(function(n){i(n,a)}):i(void 0,a)};function i(a,n){var c=zt(),s=e.url+"/oauth2/authorize?"+Oe({client_id:e.client_id,redirect_uri:e.redirect_uri,response_type:"code",scope:e.scope,state:c,code_challenge:r?a.code_challenge:void 0,code_challenge_method:r?a.code_challenge_method:void 0});if(e.singlepage){var l=Pe(window.location.search.slice(1));if(l.code){c=u("oauth2_state"),u("oauth2_state","");var p=u("oauth2_pkce_code_verifier");u("oauth2_pkce_code_verifier",""),o(l.code,p,W)}else u("oauth2_state",c),r&&u("oauth2_pkce_code_verifier",a.code_verifier),window.location=s}else{var d=600,v=550,m=[["width",d],["height",v],["left",window.screen.width/2-d/2],["top",window.screen.height/2-v/2]].map(function(S){return S.join("=")}).join(","),C=window.open("about:blank","oauth_window",m);if(t.popupWindow=C,C.location=s,!C){var w=new Error("Popup was blocked");w.status="popup-blocked",n(w)}}window.authComplete=function(S){var N=Pe(S.split("?")[1]);N.state!==c&&(w=new Error("Invalid state"),w.status="invalid-state",n(w)),o(N.code,r&&a.code_verifier,W),delete window.authComplete};function W(S,N){if(e.done(),S){n(S);return}var Fe=JSON.parse(N.response);u("oauth2_access_token",Fe.access_token),n(null,t)}}function o(a,n,c){var s=e.url+"/oauth2/token?"+Oe({client_id:e.client_id,redirect_uri:e.redirect_uri,grant_type:"authorization_code",code:a,code_verifier:r?n:void 0});t.rawxhr("POST",s,null,null,null,c),e.loading()}t.bringPopupWindowToFront=function(){var a=!1;try{t.popupWindow&&!t.popupWindow.closed&&(t.popupWindow.focus(),a=!0)}catch(n){}return a},t.bootstrapToken=function(a,n){o(a,u("oauth2_code_verifier"),c);function c(s,l){if(e.done(),s){n(s);return}var p=JSON.parse(l.response);u("oauth2_access_token",p.access_token),u("oauth2_pkce_code_verifier",""),u("oauth2_state",""),n(null,t)}},t.fetch=function(a,n,c){if(t.authenticated())return s();if(e.auto){t.authenticate(s);return}else{c("not authenticated",null);return}function s(){var l=n.prefix!==!1?e.url+a:a,p=n.headers||{"Content-Type":"application/x-www-form-urlencoded"};return p.Authorization="Bearer "+u("oauth2_access_token"),fetch(l,{method:n.method,body:n.body,headers:p}).then(function(d){var v=d.headers.get("content-type").split(";")[0];switch(v){case"text/html":case"text/xml":return d.text().then(function(m){return new window.DOMParser().parseFromString(m,v)});case"application/html":return d.json();default:return d.text()}})}},t.xhr=function(a,n){if(t.authenticated())return c();if(e.auto){t.authenticate(c);return}else{n("not authenticated",null);return}function c(){var l=a.prefix!==!1?e.url+a.path:a.path;return t.rawxhr(a.method,l,u("oauth2_access_token"),a.content,a.headers,s)}function s(l,p){l?n(l):p.responseXML?n(l,p.responseXML):n(l,p.response)}},t.rawxhr=function(a,n,c,s,l,p){l=l||{"Content-Type":"application/x-www-form-urlencoded"},c&&(l.Authorization="Bearer "+c);var d=new XMLHttpRequest;d.onreadystatechange=function(){d.readyState===4&&d.status!==0&&(/^20\d$/.test(d.status)?p(null,d):p(d,null))},d.onerror=function(m){p(m,null)},d.open(a,n,!0);for(var v in l)d.setRequestHeader(v,l[v]);return d.send(s),d},t.preauth=function(a){return a&&a.access_token&&u("oauth2_access_token",a.access_token),t},t.options=function(a){return arguments.length?(e=a,e.url=e.url||"https://www.openstreetmap.org",e.auto=e.auto||!1,e.singlepage=e.singlepage||!1,r=!e.singlepage||F.default.enabled,e.loading=e.loading||function(){},e.done=e.done||function(){},t.preauth(e)):e};var u;if(F.default.enabled)u=function(a,n){if(arguments.length===1)return F.default.get(e.url+a);if(arguments.length===2)return F.default.set(e.url+a,n)};else{var g={};u=function(a,n){if(arguments.length===1)return g[e.url+a];if(arguments.length===2)return g[e.url+a]=n}}return t.options(e),t}function Oe(e){return Object.keys(e).filter(function(t){return e[t]!==void 0}).sort().map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function Pe(e){for(var t=0;t<e.length&&(e[t]==="?"||e[t]==="#");)t++;return e=e.slice(t),e.split("&").reduce(function(r,i){var o=i.split("=");return o.length===2&&(r[o[0]]=decodeURIComponent(o[1])),r},{})}function je(){return window&&window.crypto&&window.crypto.getRandomValues&&window.crypto.subtle&&window.crypto.subtle.digest}function Lt(e){var t;if(je()){var r=window.crypto.getRandomValues(new Uint8Array(32));t=B(r.buffer);var i=Uint8Array.from(Array.from(t).map(function(g){return g.charCodeAt(0)}));window.crypto.subtle.digest("SHA-256",i).then(function(g){var a=B(g);e({code_challenge:a,code_verifier:t,code_challenge_method:"S256"})})}else{var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";t="";for(var u=0;u<64;u++)t+=o[Math.floor(Math.random()*o.length)];e({code_verifier:t,code_challenge:t,code_challenge_method:"plain"})}}function zt(){var e;if(je()){var t=window.crypto.getRandomValues(new Uint8Array(32));e=B(t.buffer)}else{var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";e="";for(var i=0;i<64;i++)e+=r[Math.floor(Math.random()*r.length)]}return e}function B(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/[=]/g,"")}return Ie(Dt);})();
//# sourceMappingURL=osm-auth.iife.js.map
