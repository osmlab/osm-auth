{
  "version": 3,
  "sources": ["../src/osm-auth.mjs"],
  "sourcesContent": ["\n/**\n * osmAuth\n * Easy authentication with OpenStreetMap over OAuth 2.0.\n * @module\n *\n * @param    o   `Object` containing options:\n * @param    o.scope          OAuth2 scopes requested (e.g. \"read_prefs write_api\")\n * @param    o.client_id      OAuth2 client ID\n * @param    o.redirect_uri   OAuth2 redirect URI (e.g. \"http://127.0.0.1:8080/land.html\")\n * @param    o.access_token   Can pre-authorize with an OAuth2 bearer token if you have one\n * @param    o.apiUrl         A base url for the OSM API (default: \"https://api.openstreetmap.org\")\n * @param    o.url            A base url for the OAuth2 handshake (default: \"https://www.openstreetmap.org\")\n * @param    o.auto           If `true`, attempt to authenticate automatically when calling `.xhr()` or `.fetch()` (default: `false`)\n * @param    o.singlepage     If `true`, use page redirection instead of a popup (default: `false`)\n * @param    o.loading        Function called when auth-related xhr calls start\n * @param    o.done           Function called when auth-related xhr calls end\n * @param    o.locale         The locale to use on the OAuth2 authentication page. Optional.\n * @return  `self`\n */\nexport function osmAuth(o) {\n  var oauth = {};\n\n  var CHANNEL_ID = 'osm-api-auth-complete';\n\n  // Mock localStorage if needed.\n  // Note that accessing localStorage may throw a `SecurityError`, so wrap in a try/catch.\n  var _store = null;\n  try {\n    _store = window.localStorage;\n  } catch (e) {\n    var _mock = new Map();\n    _store = {\n      isMocked: true,\n      hasItem: (k) => _mock.has(k),\n      getItem: (k) => _mock.get(k),\n      setItem: (k, v) => _mock.set(k, v),\n      removeItem: (k) => _mock.delete(k),\n      clear: () => _mock.clear()\n    };\n  }\n\n  /**\n   * token\n   * Get/Set tokens. These are prefixed with the base URL so that `osm-auth`\n   * can be used with multiple APIs and the keys in `localStorage` will not clash\n   * @param  {string}   k  key\n   * @param  {string?}  v  value\n   * @return {string?}  If getting, returns the stored value or `null`.  If setting, returns `undefined`.\n   */\n  function token(k, v) {\n    var key = o.url + k;\n    if (arguments.length === 1) {\n      var val = _store.getItem(key) || '';\n      // Note: legacy tokens might be wrapped in double quotes - remove them, see #129\n      return val.replace(/\"/g, '');\n\n    } else if (arguments.length === 2) {\n      if (v) {\n        return _store.setItem(key, v);\n      } else {\n        return _store.removeItem(key);\n      }\n    }\n  }\n\n\n  /**\n   * authenticated\n   * Test whether the user is currently authenticated\n   *\n   * @return {boolean} `true` if authenticated, `false` if not\n   */\n  oauth.authenticated = function() {\n    return !!token('oauth2_access_token');\n  };\n\n\n  /**\n   * logout\n   * Removes any stored authentication tokens (legacy OAuth1 tokens too)\n   *\n   * @return  `self`\n   */\n  oauth.logout = function () {\n    token('oauth2_access_token', '');         // OAuth2\n    token('oauth_token', '');                 // OAuth1\n    token('oauth_token_secret', '');          // OAuth1\n    token('oauth_request_token_secret', '');  // OAuth1\n    return oauth;\n  };\n\n\n  /**\n   * authenticate\n   * First logs out, then runs the authentiation flow, finally calls the callback.\n   * TODO: detect lack of click event  (probably can settimeout it)\n   *\n   * @param   {function}  callback  Errback-style callback `(err, result)`, called when complete\n   * @param   {LoginOptions}  [options]  Other options\n   * @return  none\n   */\n  oauth.authenticate = function(callback, options) {\n    if (oauth.authenticated()) {\n      callback(null, oauth);\n      return;\n    }\n\n    oauth.logout();\n\n    _preopenPopup(function(error, popup) {\n      if (error) {\n        callback(error);\n      } else {\n        _generatePkceChallenge(function(pkce) {\n          _authenticate(pkce, options, popup, callback);\n        });\n      }\n    });\n  };\n\n\n  /**\n   * authenticateAsync\n   * Promisified version of `authenticate`\n   * @param {LoginOptions} [options]\n   * @return  {Promise}  Promise settled with whatever `_authenticate` did\n   */\n  oauth.authenticateAsync = function(options) {\n    if (oauth.authenticated()) {\n      return Promise.resolve(oauth);\n    }\n\n    oauth.logout();\n\n    return new Promise((resolve, reject) => {\n      var errback = (err, result) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(result);\n        }\n      };\n\n      _preopenPopup((error, popup) => {\n        if (error) {\n          errback(error);\n        } else {\n          _generatePkceChallenge(pkce => _authenticate(pkce, options, popup, errback));\n        }\n      });\n    });\n  };\n\n\n  /**\n   * opens an empty popup to be later used for the authentication page\n   * @param   {function}  callback  Errback-style callback `(err, result)`, called when complete\n   * @return  none\n   */\n  function _preopenPopup(callback) {\n    if (o.singlepage) {\n      callback(null, undefined);\n      return;\n    }\n\n    // Create a 550x610 popup window in the center of the screen\n    var w = 550;\n    var h = 610;\n    var settings = [\n        ['width', w],\n        ['height', h],\n        ['left', window.screen.width / 2 - w / 2],\n        ['top', window.screen.height / 2 - h / 2],\n      ]\n      .map(function (x) { return x.join('='); })\n      .join(',');\n    var popup = window.open('about:blank', 'oauth_window', settings);\n    if (popup) {\n      callback(null, popup);\n    } else {\n      var error = new Error('Popup was blocked');\n      error.status = 'popup-blocked';\n      callback(error);\n    }\n  }\n\n\n  /**\n   * _authenticate\n   * internal authenticate\n   *\n   * @typedef {{ switchUser?: boolean }} LoginOptions\n   *\n   * @param  {Object}    pkce      Object containing PKCE code challenge properties\n   * @param  {LoginOptions=}   options   Other options\n   * @param  {Window}    popup     Popup Window to use for the authentication page, should be undefined when using singlepage mode\n   * @param  {function}  callback  Errback-style callback that accepts `(err, result)`\n   */\n  function _authenticate(pkce, options, popup, callback) {\n    var state = generateState();\n\n    // ## Request authorization to access resources from the user\n    // and receive authorization code\n    var path =\n      '/oauth2/authorize?' +\n      utilQsString({\n        client_id: o.client_id,\n        redirect_uri: o.redirect_uri,\n        response_type: 'code',\n        scope: o.scope,\n        state: state,\n        code_challenge: pkce.code_challenge,\n        code_challenge_method: pkce.code_challenge_method,\n        locale: o.locale || '',\n      });\n\n    var url = options?.switchUser\n      ? `${o.url}/logout?referer=${encodeURIComponent(`/login?referer=${encodeURIComponent(path)}`)}`\n      : o.url + path;\n\n    if (o.singlepage) {\n      if (_store.isMocked) {\n        // in singlepage mode, PKCE requires working non-volatile storage\n        var error = new Error('localStorage unavailable, but required in singlepage mode');\n        error.status = 'pkce-localstorage-unavailable';\n        callback(error);\n        return;\n      }\n      var params = utilStringQs(window.location.search.slice(1));\n      if (params.code) {\n        oauth.bootstrapToken(params.code, callback);\n      } else {\n        // save OAuth2 state and PKCE challenge in local storage, for later use\n        // in the `/oauth/token` request\n        token('oauth2_state', state);\n        token('oauth2_pkce_code_verifier', pkce.code_verifier);\n        window.location = url;\n      }\n    } else {\n      oauth.popupWindow = popup;\n      popup.location = url;\n    }\n\n    // Called by a function in the redirect URL page, in the popup window. The\n    // window closes itself.\n    var bc = new BroadcastChannel(CHANNEL_ID);\n    bc.addEventListener('message', (event) => {\n      var url = event.data;\n      var params = utilStringQs(url.split('?')[1]);\n      if (params.state !== state) {\n        var error = new Error('Invalid state');\n        error.status = 'invalid-state';\n        callback(error);\n        return;\n      }\n      _getAccessToken(params.code, pkce.code_verifier, accessTokenDone);\n      bc.close();\n    });\n\n    function accessTokenDone(err, xhr) {\n      o.done();\n      if (err) {\n        callback(err);\n        return;\n      }\n      var access_token = JSON.parse(xhr.response);\n      token('oauth2_access_token', access_token.access_token);\n      callback(null, oauth);\n    }\n  }\n\n\n  /**\n   * _getAccessToken\n   * The client requests an access token by authenticating with the\n   * authorization server and presenting the `auth_code`, brought\n   * in from a function call on a landing page popup.\n   * @param  {string}    auth_code\n   * @param  {string}    code_verifier\n   * @param  {function}  accessTokenDone  Errback-style callback `(err, result)`, called when complete\n   */\n  function _getAccessToken(auth_code, code_verifier, accessTokenDone) {\n    var url =\n      o.url +\n      '/oauth2/token?' +\n      utilQsString({\n        client_id: o.client_id,\n        redirect_uri: o.redirect_uri,\n        grant_type: 'authorization_code',\n        code: auth_code,\n        code_verifier: code_verifier\n      });\n\n    // The authorization server authenticates the client and validates\n    // the authorization grant, and if valid, issues an access token.\n    oauth.rawxhr('POST', url, null, null, null, accessTokenDone);\n    o.loading();\n  }\n\n\n  /**\n   * bringPopupWindowToFront\n   * Tries to bring an existing authentication popup to the front.\n   *\n   * @return {boolean} `true` if it succeeded, `false` if not\n   */\n  oauth.bringPopupWindowToFront = function() {\n    var broughtPopupToFront = false;\n    try {\n      // This may cause a cross-origin error:\n      // `DOMException: Blocked a frame with origin \"...\" from accessing a cross-origin frame.`\n      if (oauth.popupWindow && !oauth.popupWindow.closed) {\n        oauth.popupWindow.focus();\n        broughtPopupToFront = true;\n      }\n    } catch (err) {\n      // Bringing popup window to front failed (probably because of the cross-origin error mentioned above)\n    }\n    return broughtPopupToFront;\n  };\n\n\n  /**\n   * bootstrapToken\n   * The authorization code is a temporary code that a client can exchange for an access token.\n   * If using this library in single-page mode, you'll need to call this once your application\n   * has an `auth_code` and wants to get an access_token.\n   *\n   * @param   {string}   auth_code  The OAuth2 `auth_code`\n   * @param   {function} callback   Errback-style callback `(err, result)`, called when complete\n   * @return  none\n   */\n  oauth.bootstrapToken = function(auth_code, callback) {\n    var state = token('oauth2_state');\n    token('oauth2_state', '');\n    var params = utilStringQs(window.location.search.slice(1));\n    if (params.state !== state) {\n      var error = new Error('Invalid state');\n      error.status = 'invalid-state';\n      callback(error);\n      return;\n    }\n    var code_verifier = token('oauth2_pkce_code_verifier');\n    token('oauth2_pkce_code_verifier', '');\n    _getAccessToken(auth_code, code_verifier, accessTokenDone);\n\n    function accessTokenDone(err, xhr) {\n      o.done();\n      if (err) {\n        callback(err);\n        return;\n      }\n      var access_token = JSON.parse(xhr.response);\n      token('oauth2_access_token', access_token.access_token);\n      callback(null, oauth);\n    }\n  };\n\n\n  /**\n   * fetch\n   * A `fetch` wrapper that includes the Authorization header if the user is authenticated.\n   * https://developer.mozilla.org/en-US/docs/Web/API/fetch\n   *\n   * @param  {string}   resource    Resource passed to `fetch`\n   * @param  {Object}   options     Options passed to `fetch`\n   * @return {Promise}  Promise that wraps `authenticateAsync` then `fetch`\n   */\n  oauth.fetch = function(resource, options) {\n    if (oauth.authenticated()) {\n      return _doFetch();\n    } else {\n      if (o.auto) {\n        return oauth.authenticateAsync().then(_doFetch);\n      } else {\n        return Promise.reject(new Error('not authenticated'));\n      }\n    }\n\n    function _doFetch() {\n      options = options || {};\n      if (!options.headers) {\n        options.headers = { 'Content-Type': 'application/x-www-form-urlencoded' };\n      }\n      options.headers.Authorization = 'Bearer ' + token('oauth2_access_token');\n      return fetch(resource, options);\n    }\n  };\n\n\n  /**\n   * xhr\n   * A `XMLHttpRequest` wrapper that does authenticated calls if the user has logged in.\n   * https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n   *\n   * @param   {Object} options\n   * @param    options.method   Passed to `xhr.open`  (e.g. 'GET', 'POST')\n   * @param    options.prefix   If `true` path contains a path, if `false` path contains the full url\n   * @param    options.path     The URL path (e.g. \"/api/0.6/user/details\") (or full url, if `prefix`=`false`)\n   * @param    options.content  Passed to `xhr.send`\n   * @param    options.headers  `Object` containing request headers\n   * @param   {function}         callback  Errback-style callback `(err, result)`, called when complete\n   * @return  {XMLHttpRequest}  `XMLHttpRequest` if authenticated, otherwise `null`\n   */\n  oauth.xhr = function (options, callback) {\n    if (oauth.authenticated()) {\n      return _doXHR();\n    } else {\n      if (o.auto) {\n        oauth.authenticate(_doXHR);\n        return;\n      } else {\n        callback('not authenticated', null);\n        return;\n      }\n    }\n\n    function _doXHR() {\n      var url = options.prefix !== false ? (o.apiUrl + options.path) : options.path;\n      return oauth.rawxhr(\n        options.method,\n        url,\n        token('oauth2_access_token'),\n        options.content,\n        options.headers,\n        done\n      );\n    }\n\n    function done(err, xhr) {\n      if (err) {\n        callback(err);\n      } else if (xhr.responseXML) {\n        callback(err, xhr.responseXML);\n      } else {\n        callback(err, xhr.response);\n      }\n    }\n  };\n\n\n  /**\n   * rawxhr\n   * Creates the XMLHttpRequest set up with a header and response handling\n   * https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n   *\n   * @param    method         Passed to `xhr.open`  (e.g. 'GET', 'POST')\n   * @param    url            Passed to `xhr.open`\n   * @param    access_token   OAuth2 bearer token\n   * @param    data           Passed to `xhr.send`\n   * @param    headers        `Object` containing request headers\n   * @param    callback       An \"errback\"-style callback (`err`, `result`), called when complete\n   * @return  `XMLHttpRequest`\n   */\n  oauth.rawxhr = function(method, url, access_token, data, headers, callback) {\n    headers = headers || { 'Content-Type': 'application/x-www-form-urlencoded' };\n\n    if (access_token) {\n      headers.Authorization = 'Bearer ' + access_token;\n    }\n\n    var xhr = new XMLHttpRequest();\n\n    xhr.onreadystatechange = function () {\n      if (4 === xhr.readyState && 0 !== xhr.status) {\n        if (/^20\\d$/.test(xhr.status)) {   // a 20x status code - OK\n          callback(null, xhr);\n        } else {\n          callback(xhr, null);\n        }\n      }\n    };\n    xhr.onerror = function (e) {\n      callback(e, null);\n    };\n\n    xhr.open(method, url, true);\n    for (var h in headers) xhr.setRequestHeader(h, headers[h]);\n\n    xhr.send(data);\n    return xhr;\n  };\n\n\n  /**\n   * preauth\n   * Pre-authorize this object, if we already have access token from the start\n   *\n   * @param   {Object}  val  Object containing `access_token` property\n   * @return  `self`\n   */\n  oauth.preauth = function(val) {\n    if (val && val.access_token) {\n      token('oauth2_access_token', val.access_token);\n    }\n    return oauth;\n  };\n\n\n  /**\n   * options  (getter / setter)\n   * If passed with no arguments, just return the options\n   * If passed an Object, set the options then attempt to pre-authorize\n   *\n   * @param   val?   Object containing options\n   * @return  current `options` (if getting), or `self` (if setting)\n   */\n  oauth.options = function(val) {\n    if (!arguments.length) return o;\n\n    o = val;\n    o.apiUrl = o.apiUrl || 'https://api.openstreetmap.org';\n    o.url = o.url || 'https://www.openstreetmap.org';\n    o.auto = o.auto || false;\n    o.singlepage = o.singlepage || false;\n\n    // Optional loading and loading-done functions for nice UI feedback.\n    // by default, no-ops\n    o.loading = o.loading || function () {};\n    o.done = o.done || function () {};\n    return oauth.preauth(o);\n  };\n\n\n  // Everything below here is initialization/setup code\n  // Handle options and attempt to pre-authorize\n  oauth.options(o);\n\n  return oauth;\n}\n\n\n/**\n * utilQsString\n * Transforms object of `key=value` pairs into query string\n * @param   {Object}  Object of `key=value` pairs\n * @returns {string}  query string\n */\nfunction utilQsString(obj) {\n  return Object.keys(obj)\n    .filter(function(key) {\n      return obj[key] !== undefined;\n    })\n    .sort()\n    .map(function(key) {\n      return (encodeURIComponent(key) + '=' + encodeURIComponent(obj[key]));\n    })\n    .join('&');\n}\n\n/**\n * utilStringQs\n * Transforms query string into object of `key=value` pairs\n * @param   {string}  query string\n * @returns {Object}  Object of `key=value` pairs\n */\nfunction utilStringQs(str) {\n  var i = 0; // advance past any leading '?' or '#' characters\n  while (i < str.length && (str[i] === '?' || str[i] === '#')) i++;\n  str = str.slice(i);\n\n  return str.split('&').reduce(function(obj, pair) {\n    var parts = pair.split('=');\n    if (parts.length === 2) {\n      obj[parts[0]] = decodeURIComponent(parts[1]);\n    }\n    return obj;\n  }, {});\n}\n\n\n/**\n * supportsWebCryptoAPI\n * https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API\n * @returns {boolean}  `true` if WebCryptoAPI is available\n */\nfunction supportsWebCryptoAPI() {\n  return window && window.crypto\n    && window.crypto.getRandomValues\n    && window.crypto.subtle\n    && window.crypto.subtle.digest;\n}\n\n\n/**\n * Generates a challenge/verifier pair for PKCE.\n * If the browser does not support the WebCryptoAPI, the \"plain\" method is\n * used as a fallback instead of a SHA-256 hash.\n * @param {callback} callback called with the result of the generated PKCE challenge\n */\nfunction _generatePkceChallenge(callback) {\n  var code_verifier;\n  if (supportsWebCryptoAPI()) {\n    // generate a random code_verifier\n    // https://datatracker.ietf.org/doc/html/rfc7636#section-7.1\n    var random = window.crypto.getRandomValues(new Uint8Array(32));\n    code_verifier = base64(random.buffer);\n    var verifier = Uint8Array.from(Array.from(code_verifier).map(function(char) {\n      return char.charCodeAt(0);\n    }));\n\n    // generate challenge for code verifier\n    window.crypto.subtle.digest('SHA-256', verifier).then(function(hash) {\n      var code_challenge = base64(hash);\n\n      callback({\n        code_challenge: code_challenge,\n        code_verifier: code_verifier,\n        code_challenge_method: 'S256'\n      });\n    });\n  } else {\n    // browser does not support Web Crypto API (e.g. IE11) -> fall back to \"plain\" method\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_';\n    code_verifier = '';\n    for (var i=0; i<64; i++) {\n      code_verifier += chars[Math.floor(Math.random() * chars.length)];\n    }\n    callback({\n      code_verifier: code_verifier,\n      code_challenge: code_verifier,\n      code_challenge_method: 'plain',\n    });\n  }\n}\n\n\n/**\n * Returns a random state to be used as the \"state\" of the OAuth2 authentication\n * See https://datatracker.ietf.org/doc/html/rfc6749#section-10.12\n */\nfunction generateState() {\n  var state;\n  if (supportsWebCryptoAPI()) {\n    var random = window.crypto.getRandomValues(new Uint8Array(32));\n    state = base64(random.buffer);\n  } else {\n    // browser does not support Web Crypto API (e.g. IE11) -> fall back to \"plain\" method\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_';\n    state = '';\n    for (var i=0; i<64; i++) {\n      state += chars[Math.floor(Math.random() * chars.length)];\n    }\n  }\n  return state;\n}\n\n\n/**\n * base64\n * Converts binary buffer to base64 encoded string, as used in rfc7636\n * @param    {ArrayBuffer}  buffer\n * @returns  {string}       base64 encoded\n */\nfunction base64(buffer) {\n  return btoa(String.fromCharCode.apply(null, new Uint8Array(buffer)))\n    .replace(/\\//g, '_')\n    .replace(/\\+/g, '-')\n    .replace(/[=]/g, '');\n}\n"],
  "mappings": "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",
  "names": ["osm_auth_exports", "__export", "osmAuth", "o", "oauth", "CHANNEL_ID", "_store", "e", "_mock", "k", "v", "token", "key", "val", "callback", "options", "_preopenPopup", "error", "popup", "_generatePkceChallenge", "pkce", "_authenticate", "resolve", "reject", "errback", "err", "result", "w", "h", "settings", "x", "state", "generateState", "path", "utilQsString", "url", "params", "utilStringQs", "bc", "event", "_getAccessToken", "accessTokenDone", "xhr", "access_token", "auth_code", "code_verifier", "broughtPopupToFront", "resource", "_doFetch", "_doXHR", "done", "method", "data", "headers", "obj", "str", "i", "pair", "parts", "supportsWebCryptoAPI", "random", "base64", "verifier", "char", "hash", "code_challenge", "chars", "buffer"]
}
