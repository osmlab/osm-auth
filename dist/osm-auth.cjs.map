{
  "version": 3,
  "sources": ["../src/osm-auth.mjs"],
  "sourcesContent": ["\n/**\n * osmAuth\n * Easy authentication with OpenStreetMap over OAuth 2.0.\n * @module\n *\n * @param    o   `Object` containing options:\n * @param    o.scope          OAuth2 scopes requested (e.g. \"read_prefs write_api\")\n * @param    o.client_id      OAuth2 client ID\n * @param    o.redirect_uri   OAuth2 redirect URI (e.g. \"http://127.0.0.1:8080/land.html\")\n * @param    o.access_token   Can pre-authorize with an OAuth2 bearer token if you have one\n * @param    o.apiUrl         A base url for the OSM API (default: \"https://api.openstreetmap.org\")\n * @param    o.url            A base url for the OAuth2 handshake (default: \"https://www.openstreetmap.org\")\n * @param    o.auto           If `true`, attempt to authenticate automatically when calling `.xhr()` or `.fetch()` (default: `false`)\n * @param    o.singlepage     If `true`, use page redirection instead of a popup (default: `false`)\n * @param    o.loading        Function called when auth-related xhr calls start\n * @param    o.done           Function called when auth-related xhr calls end\n * @param    o.locale         The locale to use on the OAuth2 authentication page. Optional.\n * @return  `self`\n */\nexport function osmAuth(o) {\n  var oauth = {};\n\n  var CHANNEL_ID = 'osm-api-auth-complete';\n\n  // Mock localStorage if needed.\n  // Note that accessing localStorage may throw a `SecurityError`, so wrap in a try/catch.\n  var _store = null;\n  try {\n    _store = window.localStorage;\n  } catch (e) {\n    var _mock = new Map();\n    _store = {\n      isMocked: true,\n      hasItem: (k) => _mock.has(k),\n      getItem: (k) => _mock.get(k),\n      setItem: (k, v) => _mock.set(k, v),\n      removeItem: (k) => _mock.delete(k),\n      clear: () => _mock.clear()\n    };\n  }\n\n  /**\n   * token\n   * Get/Set tokens. These are prefixed with the base URL so that `osm-auth`\n   * can be used with multiple APIs and the keys in `localStorage` will not clash\n   * @param  {string}   k  key\n   * @param  {string?}  v  value\n   * @return {string?}  If getting, returns the stored value or `null`.  If setting, returns `undefined`.\n   */\n  function token(k, v) {\n    var key = o.url + k;\n    if (arguments.length === 1) {\n      var val = _store.getItem(key) || '';\n      // Note: legacy tokens might be wrapped in double quotes - remove them, see #129\n      return val.replace(/\"/g, '');\n\n    } else if (arguments.length === 2) {\n      if (v) {\n        return _store.setItem(key, v);\n      } else {\n        return _store.removeItem(key);\n      }\n    }\n  }\n\n\n  /**\n   * authenticated\n   * Test whether the user is currently authenticated\n   *\n   * @return {boolean} `true` if authenticated, `false` if not\n   */\n  oauth.authenticated = function() {\n    return !!token('oauth2_access_token');\n  };\n\n\n  /**\n   * logout\n   * Removes any stored authentication tokens (legacy OAuth1 tokens too)\n   *\n   * @return  `self`\n   */\n  oauth.logout = function () {\n    token('oauth2_access_token', '');         // OAuth2\n    token('oauth_token', '');                 // OAuth1\n    token('oauth_token_secret', '');          // OAuth1\n    token('oauth_request_token_secret', '');  // OAuth1\n    return oauth;\n  };\n\n\n  /**\n   * authenticate\n   * First logs out, then runs the authentiation flow, finally calls the callback.\n   * TODO: detect lack of click event  (probably can settimeout it)\n   *\n   * @param   {function}  callback  Errback-style callback `(err, result)`, called when complete\n   * @param   {LoginOptions}  [options]  Other options\n   * @return  none\n   */\n  oauth.authenticate = function(callback, options) {\n    if (oauth.authenticated()) {\n      callback(null, oauth);\n      return;\n    }\n\n    oauth.logout();\n\n    _preopenPopup(function(error, popup) {\n      if (error) {\n        callback(error);\n      } else {\n        _generatePkceChallenge(function(pkce) {\n          _authenticate(pkce, options, popup, callback);\n        });\n      }\n    });\n  };\n\n\n  /**\n   * authenticateAsync\n   * Promisified version of `authenticate`\n   * @param {LoginOptions} [options]\n   * @return  {Promise}  Promise settled with whatever `_authenticate` did\n   */\n  oauth.authenticateAsync = function(options) {\n    if (oauth.authenticated()) {\n      return Promise.resolve(oauth);\n    }\n\n    oauth.logout();\n\n    return new Promise((resolve, reject) => {\n      var errback = (err, result) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(result);\n        }\n      };\n\n      _preopenPopup((error, popup) => {\n        if (error) {\n          errback(error);\n        } else {\n          _generatePkceChallenge(pkce => _authenticate(pkce, options, popup, errback));\n        }\n      });\n    });\n  };\n\n\n  /**\n   * opens an empty popup to be later used for the authentication page\n   * @param   {function}  callback  Errback-style callback `(err, result)`, called when complete\n   * @return  none\n   */\n  function _preopenPopup(callback) {\n    if (o.singlepage) {\n      callback(null, undefined);\n      return;\n    }\n\n    // Create a 550x610 popup window in the center of the screen\n    var w = 550;\n    var h = 610;\n    var settings = [\n        ['width', w],\n        ['height', h],\n        ['left', window.screen.width / 2 - w / 2],\n        ['top', window.screen.height / 2 - h / 2],\n      ]\n      .map(function (x) { return x.join('='); })\n      .join(',');\n    var popup = window.open('about:blank', 'oauth_window', settings);\n    if (popup) {\n      callback(null, popup);\n    } else {\n      var error = new Error('Popup was blocked');\n      error.status = 'popup-blocked';\n      callback(error);\n    }\n  }\n\n\n  /**\n   * _authenticate\n   * internal authenticate\n   *\n   * @typedef {{ switchUser?: boolean }} LoginOptions\n   *\n   * @param  {Object}    pkce      Object containing PKCE code challenge properties\n   * @param  {LoginOptions=}   options   Other options\n   * @param  {Window}    popup     Popup Window to use for the authentication page, should be undefined when using singlepage mode\n   * @param  {function}  callback  Errback-style callback that accepts `(err, result)`\n   */\n  function _authenticate(pkce, options, popup, callback) {\n    var state = generateState();\n\n    // ## Request authorization to access resources from the user\n    // and receive authorization code\n    var path =\n      '/oauth2/authorize?' +\n      utilQsString({\n        client_id: o.client_id,\n        redirect_uri: o.redirect_uri,\n        response_type: 'code',\n        scope: o.scope,\n        state: state,\n        code_challenge: pkce.code_challenge,\n        code_challenge_method: pkce.code_challenge_method,\n        locale: o.locale || '',\n      });\n\n    var url = options?.switchUser\n      ? `${o.url}/logout?referer=${encodeURIComponent(`/login?referer=${encodeURIComponent(path)}`)}`\n      : o.url + path;\n\n    if (o.singlepage) {\n      if (_store.isMocked) {\n        // in singlepage mode, PKCE requires working non-volatile storage\n        var error = new Error('localStorage unavailable, but required in singlepage mode');\n        error.status = 'pkce-localstorage-unavailable';\n        callback(error);\n        return;\n      }\n      var params = utilStringQs(window.location.search.slice(1));\n      if (params.code) {\n        oauth.bootstrapToken(params.code, callback);\n      } else {\n        // save OAuth2 state and PKCE challenge in local storage, for later use\n        // in the `/oauth/token` request\n        token('oauth2_state', state);\n        token('oauth2_pkce_code_verifier', pkce.code_verifier);\n        window.location = url;\n      }\n    } else {\n      oauth.popupWindow = popup;\n      popup.location = url;\n    }\n\n    // Called by a function in the redirect URL page, in the popup window. The\n    // window closes itself.\n    var bc = new BroadcastChannel(CHANNEL_ID);\n    bc.addEventListener('message', (event) => {\n      var url = event.data;\n      var params = utilStringQs(url.split('?')[1]);\n      if (params.state !== state) {\n        var error = new Error('Invalid state');\n        error.status = 'invalid-state';\n        callback(error);\n        return;\n      }\n      _getAccessToken(params.code, pkce.code_verifier, accessTokenDone);\n      bc.close();\n    });\n\n    function accessTokenDone(err, xhr) {\n      o.done();\n      if (err) {\n        callback(err);\n        return;\n      }\n      var access_token = JSON.parse(xhr.response);\n      token('oauth2_access_token', access_token.access_token);\n      callback(null, oauth);\n    }\n  }\n\n\n  /**\n   * _getAccessToken\n   * The client requests an access token by authenticating with the\n   * authorization server and presenting the `auth_code`, brought\n   * in from a function call on a landing page popup.\n   * @param  {string}    auth_code\n   * @param  {string}    code_verifier\n   * @param  {function}  accessTokenDone  Errback-style callback `(err, result)`, called when complete\n   */\n  function _getAccessToken(auth_code, code_verifier, accessTokenDone) {\n    var url =\n      o.url +\n      '/oauth2/token?' +\n      utilQsString({\n        client_id: o.client_id,\n        redirect_uri: o.redirect_uri,\n        grant_type: 'authorization_code',\n        code: auth_code,\n        code_verifier: code_verifier\n      });\n\n    // The authorization server authenticates the client and validates\n    // the authorization grant, and if valid, issues an access token.\n    oauth.rawxhr('POST', url, null, null, null, accessTokenDone);\n    o.loading();\n  }\n\n\n  /**\n   * bringPopupWindowToFront\n   * Tries to bring an existing authentication popup to the front.\n   *\n   * @return {boolean} `true` if it succeeded, `false` if not\n   */\n  oauth.bringPopupWindowToFront = function() {\n    var broughtPopupToFront = false;\n    try {\n      // This may cause a cross-origin error:\n      // `DOMException: Blocked a frame with origin \"...\" from accessing a cross-origin frame.`\n      if (oauth.popupWindow && !oauth.popupWindow.closed) {\n        oauth.popupWindow.focus();\n        broughtPopupToFront = true;\n      }\n    } catch (err) {\n      // Bringing popup window to front failed (probably because of the cross-origin error mentioned above)\n    }\n    return broughtPopupToFront;\n  };\n\n\n  /**\n   * bootstrapToken\n   * The authorization code is a temporary code that a client can exchange for an access token.\n   * If using this library in single-page mode, you'll need to call this once your application\n   * has an `auth_code` and wants to get an access_token.\n   *\n   * @param   {string}   auth_code  The OAuth2 `auth_code`\n   * @param   {function} callback   Errback-style callback `(err, result)`, called when complete\n   * @return  none\n   */\n  oauth.bootstrapToken = function(auth_code, callback) {\n    var state = token('oauth2_state');\n    token('oauth2_state', '');\n    var params = utilStringQs(window.location.search.slice(1));\n    if (params.state !== state) {\n      var error = new Error('Invalid state');\n      error.status = 'invalid-state';\n      callback(error);\n      return;\n    }\n    var code_verifier = token('oauth2_pkce_code_verifier');\n    token('oauth2_pkce_code_verifier', '');\n    _getAccessToken(auth_code, code_verifier, accessTokenDone);\n\n    function accessTokenDone(err, xhr) {\n      o.done();\n      if (err) {\n        callback(err);\n        return;\n      }\n      var access_token = JSON.parse(xhr.response);\n      token('oauth2_access_token', access_token.access_token);\n      callback(null, oauth);\n    }\n  };\n\n\n  /**\n   * fetch\n   * A `fetch` wrapper that includes the Authorization header if the user is authenticated.\n   * https://developer.mozilla.org/en-US/docs/Web/API/fetch\n   *\n   * @param  {string}   resource    Resource passed to `fetch`\n   * @param  {Object}   options     Options passed to `fetch`\n   * @return {Promise}  Promise that wraps `authenticateAsync` then `fetch`\n   */\n  oauth.fetch = function(resource, options) {\n    if (oauth.authenticated()) {\n      return _doFetch();\n    } else {\n      if (o.auto) {\n        return oauth.authenticateAsync().then(_doFetch);\n      } else {\n        return Promise.reject(new Error('not authenticated'));\n      }\n    }\n\n    function _doFetch() {\n      options = options || {};\n      if (!options.headers) {\n        options.headers = { 'Content-Type': 'application/x-www-form-urlencoded' };\n      }\n      options.headers.Authorization = 'Bearer ' + token('oauth2_access_token');\n      return fetch(resource, options);\n    }\n  };\n\n\n  /**\n   * xhr\n   * A `XMLHttpRequest` wrapper that does authenticated calls if the user has logged in.\n   * https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n   *\n   * @param   {Object} options\n   * @param    options.method   Passed to `xhr.open`  (e.g. 'GET', 'POST')\n   * @param    options.prefix   If `true` path contains a path, if `false` path contains the full url\n   * @param    options.path     The URL path (e.g. \"/api/0.6/user/details\") (or full url, if `prefix`=`false`)\n   * @param    options.content  Passed to `xhr.send`\n   * @param    options.headers  `Object` containing request headers\n   * @param   {function}         callback  Errback-style callback `(err, result)`, called when complete\n   * @return  {XMLHttpRequest}  `XMLHttpRequest` if authenticated, otherwise `null`\n   */\n  oauth.xhr = function (options, callback) {\n    if (oauth.authenticated()) {\n      return _doXHR();\n    } else {\n      if (o.auto) {\n        oauth.authenticate(_doXHR);\n        return;\n      } else {\n        callback('not authenticated', null);\n        return;\n      }\n    }\n\n    function _doXHR() {\n      var url = options.prefix !== false ? (o.apiUrl + options.path) : options.path;\n      return oauth.rawxhr(\n        options.method,\n        url,\n        token('oauth2_access_token'),\n        options.content,\n        options.headers,\n        done\n      );\n    }\n\n    function done(err, xhr) {\n      if (err) {\n        callback(err);\n      } else if (xhr.responseXML) {\n        callback(err, xhr.responseXML);\n      } else {\n        callback(err, xhr.response);\n      }\n    }\n  };\n\n\n  /**\n   * rawxhr\n   * Creates the XMLHttpRequest set up with a header and response handling\n   * https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n   *\n   * @param    method         Passed to `xhr.open`  (e.g. 'GET', 'POST')\n   * @param    url            Passed to `xhr.open`\n   * @param    access_token   OAuth2 bearer token\n   * @param    data           Passed to `xhr.send`\n   * @param    headers        `Object` containing request headers\n   * @param    callback       An \"errback\"-style callback (`err`, `result`), called when complete\n   * @return  `XMLHttpRequest`\n   */\n  oauth.rawxhr = function(method, url, access_token, data, headers, callback) {\n    headers = headers || { 'Content-Type': 'application/x-www-form-urlencoded' };\n\n    if (access_token) {\n      headers.Authorization = 'Bearer ' + access_token;\n    }\n\n    var xhr = new XMLHttpRequest();\n\n    xhr.onreadystatechange = function () {\n      if (4 === xhr.readyState && 0 !== xhr.status) {\n        if (/^20\\d$/.test(xhr.status)) {   // a 20x status code - OK\n          callback(null, xhr);\n        } else {\n          callback(xhr, null);\n        }\n      }\n    };\n    xhr.onerror = function (e) {\n      callback(e, null);\n    };\n\n    xhr.open(method, url, true);\n    for (var h in headers) xhr.setRequestHeader(h, headers[h]);\n\n    xhr.send(data);\n    return xhr;\n  };\n\n\n  /**\n   * preauth\n   * Pre-authorize this object, if we already have access token from the start\n   *\n   * @param   {Object}  val  Object containing `access_token` property\n   * @return  `self`\n   */\n  oauth.preauth = function(val) {\n    if (val && val.access_token) {\n      token('oauth2_access_token', val.access_token);\n    }\n    return oauth;\n  };\n\n\n  /**\n   * options  (getter / setter)\n   * If passed with no arguments, just return the options\n   * If passed an Object, set the options then attempt to pre-authorize\n   *\n   * @param   val?   Object containing options\n   * @return  current `options` (if getting), or `self` (if setting)\n   */\n  oauth.options = function(val) {\n    if (!arguments.length) return o;\n\n    o = val;\n    o.apiUrl = o.apiUrl || 'https://api.openstreetmap.org';\n    o.url = o.url || 'https://www.openstreetmap.org';\n    o.auto = o.auto || false;\n    o.singlepage = o.singlepage || false;\n\n    // Optional loading and loading-done functions for nice UI feedback.\n    // by default, no-ops\n    o.loading = o.loading || function () {};\n    o.done = o.done || function () {};\n    return oauth.preauth(o);\n  };\n\n\n  // Everything below here is initialization/setup code\n  // Handle options and attempt to pre-authorize\n  oauth.options(o);\n\n  return oauth;\n}\n\n\n/**\n * utilQsString\n * Transforms object of `key=value` pairs into query string\n * @param   {Object}  Object of `key=value` pairs\n * @returns {string}  query string\n */\nfunction utilQsString(obj) {\n  return Object.keys(obj)\n    .filter(function(key) {\n      return obj[key] !== undefined;\n    })\n    .sort()\n    .map(function(key) {\n      return (encodeURIComponent(key) + '=' + encodeURIComponent(obj[key]));\n    })\n    .join('&');\n}\n\n/**\n * utilStringQs\n * Transforms query string into object of `key=value` pairs\n * @param   {string}  query string\n * @returns {Object}  Object of `key=value` pairs\n */\nfunction utilStringQs(str) {\n  var i = 0; // advance past any leading '?' or '#' characters\n  while (i < str.length && (str[i] === '?' || str[i] === '#')) i++;\n  str = str.slice(i);\n\n  return str.split('&').reduce(function(obj, pair) {\n    var parts = pair.split('=');\n    if (parts.length === 2) {\n      obj[parts[0]] = decodeURIComponent(parts[1]);\n    }\n    return obj;\n  }, {});\n}\n\n\n/**\n * supportsWebCryptoAPI\n * https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API\n * @returns {boolean}  `true` if WebCryptoAPI is available\n */\nfunction supportsWebCryptoAPI() {\n  return window && window.crypto\n    && window.crypto.getRandomValues\n    && window.crypto.subtle\n    && window.crypto.subtle.digest;\n}\n\n\n/**\n * Generates a challenge/verifier pair for PKCE.\n * If the browser does not support the WebCryptoAPI, the \"plain\" method is\n * used as a fallback instead of a SHA-256 hash.\n * @param {callback} callback called with the result of the generated PKCE challenge\n */\nfunction _generatePkceChallenge(callback) {\n  var code_verifier;\n  if (supportsWebCryptoAPI()) {\n    // generate a random code_verifier\n    // https://datatracker.ietf.org/doc/html/rfc7636#section-7.1\n    var random = window.crypto.getRandomValues(new Uint8Array(32));\n    code_verifier = base64(random.buffer);\n    var verifier = Uint8Array.from(Array.from(code_verifier).map(function(char) {\n      return char.charCodeAt(0);\n    }));\n\n    // generate challenge for code verifier\n    window.crypto.subtle.digest('SHA-256', verifier).then(function(hash) {\n      var code_challenge = base64(hash);\n\n      callback({\n        code_challenge: code_challenge,\n        code_verifier: code_verifier,\n        code_challenge_method: 'S256'\n      });\n    });\n  } else {\n    // browser does not support Web Crypto API (e.g. IE11) -> fall back to \"plain\" method\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_';\n    code_verifier = '';\n    for (var i=0; i<64; i++) {\n      code_verifier += chars[Math.floor(Math.random() * chars.length)];\n    }\n    callback({\n      code_verifier: code_verifier,\n      code_challenge: code_verifier,\n      code_challenge_method: 'plain',\n    });\n  }\n}\n\n\n/**\n * Returns a random state to be used as the \"state\" of the OAuth2 authentication\n * See https://datatracker.ietf.org/doc/html/rfc6749#section-10.12\n */\nfunction generateState() {\n  var state;\n  if (supportsWebCryptoAPI()) {\n    var random = window.crypto.getRandomValues(new Uint8Array(32));\n    state = base64(random.buffer);\n  } else {\n    // browser does not support Web Crypto API (e.g. IE11) -> fall back to \"plain\" method\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_';\n    state = '';\n    for (var i=0; i<64; i++) {\n      state += chars[Math.floor(Math.random() * chars.length)];\n    }\n  }\n  return state;\n}\n\n\n/**\n * base64\n * Converts binary buffer to base64 encoded string, as used in rfc7636\n * @param    {ArrayBuffer}  buffer\n * @returns  {string}       base64 encoded\n */\nfunction base64(buffer) {\n  return btoa(String.fromCharCode.apply(null, new Uint8Array(buffer)))\n    .replace(/\\//g, '_')\n    .replace(/\\+/g, '-')\n    .replace(/[=]/g, '');\n}\n"],
  "mappings": "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",
  "names": ["url", "params", "error"]
}
